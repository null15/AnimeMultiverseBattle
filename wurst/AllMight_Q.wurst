package AllMight_Q

import Entity
import abilityDefinitions
import SpellAPI
import ClosureForGroups

function onCast()
	if GetSpellAbilityId() == ALL_MIGHT_Q
		let caster = GetTriggerUnit()
		let uEnt = caster.getEntity()
		let start = uEnt != null ? uEnt.getPos().add(0, 0, 25) : caster.getPos3Real().add(0, 0, 25)
		let source2 = start.toVec2()
		let aim = vec2(GetSpellTargetX(), GetSpellTargetY())
		let bas = source2.angleTo(aim)
		let range = 600.

		let half = (60).fromDeg() / 2.
		forUnitsInRange(source2, range) (unit u) ->
			if u != caster and caster.isEnemyOf(u)
				let pos = u.getPos().toVec3()
				if isPointInCone(pos.x, pos.y, source2.x, source2.y, range, bas.radians(), half.radians())
					caster.damageTarget(u, 50, ATTACK_TYPE_HERO)

init
	registerPlayerUnitEvent(EVENT_PLAYER_UNIT_SPELL_EFFECT, () -> onCast())