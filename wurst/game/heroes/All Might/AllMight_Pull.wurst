package AllMight_Pull

import objectIDs
import Pull
import ClosureForGroups
import RegisterEvents
import ClosureTimers
import TimeStopOverlay

function onCast()
	if GetSpellAbilityId() == ALL_MIGHT_PULL1
		let caster = GetTriggerUnit()
		let target = GetSpellTargetUnit()
		if target != null and caster.isEnemyOf(target)
			Pull.toUnit(target, caster, 128., 800.)
	if GetSpellAbilityId() == ALL_MIGHT_PULL2
		let caster = GetTriggerUnit()
		let center = EventData.getSpellTargetPos()
		forUnitsInRange(center, 600.) (unit u) ->
			if caster.isEnemyOf(u)
				Pull.toPoint(u, center, 128., 800.)

function prop()
	if GetSpellAbilityId() == 'root'
		let targ = GetSpellTargetUnit()
		let tOwner = targ.getOwner()
		let propWindow = targ.getPropWindow()
		let turnRate = targ.getField(UNIT_RF_TURN_RATE)

		targ..setPropWindow(angle(0))
		..setField(UNIT_RF_TURN_RATE, 0)
		..disableAttack(true, false)
		..setTimeScale(0)
		tOwner.disableControl()

		doAfter(2) -> 
			targ..setPropWindow(angle(propWindow.radians()))
			..setField(UNIT_RF_TURN_RATE, turnRate)
			..disableAttack(false, false)
			..setTimeScale(1)
			tOwner.enableControl()

init
	registerPlayerUnitEvent(EVENT_PLAYER_UNIT_SPELL_EFFECT, () -> onCast())
	registerPlayerUnitEvent(EVENT_PLAYER_UNIT_SPELL_EFFECT, () -> prop())